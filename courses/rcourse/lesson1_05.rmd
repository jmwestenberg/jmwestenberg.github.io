---
title: Download Loop
linktitle: Download Loop
toc: false
type: docs  # Do not modify.
date: "2021-01-25T00:00:00Z"
draft: false
# Add menu entry to sidebar.
# - name: Declare this menu item as a parent with ID `name`.
# - weight: Position of link in menu.
menu:
  rcourse:
    parent: Lesson 1
    weight: 3

weight: 60
---

```{r, include=FALSE}
local({
  hook_source <- knitr::knit_hooks$get('source')
  knitr::knit_hooks$set(source = function(x, options) {
    x <- xfun::split_lines(x)
    n <- nchar(x, 'width')
    i <- seq_along(x)  # line numbers
    n <- n + nchar(i)
    s <- knitr:::v_spaces(max(n) - n)
    x <- paste(x, s, '  # ', i, sep = '', collapse = '\n')
    hook_source(x, options)
  })
})
```


```{r eval=FALSE}
require(stringr)
years<-c(0:19, 90:99)
years<-str_pad(as.character(years), 2, "left", "0")
i=1
repeat{
url<-paste0("https://www.bls.gov/lau/laucnty", years[i], ".xlsx")
destination<-paste0(workingdir, "/raw_data/", "bls_unemp_", years[i], ".xlsx")
download.file(url, destination, mode="wb")
if (i==length(years)){
  break
  }
i<-i+1
}
```

First let's think what we are trying to achieve. The links for the downloads are all in the form of https://www.bls.gov/lau/laucntyZZ.xlsx, where ZZ is two digits representing the year. These ZZ values run from "90"to "99" for years 1990-1999 and "00" to "19" for years 2000-2019.

Let's work through the above code line by line:

- Line #1: we will be using a package called stringr. Packages allow us to add more functions into R. In line #3 we will be using str_pad from the stringr package.
- Line #2: we can declare vectors by typing two integers separated by a semicolon. (Ex: "1:4" would generate a vector (1,2,3,4)). Here we want to generate a vector that runs 0 through 19, then 90 through 99 (for the years). 
- Line #3 : We have a vector for years, however if we notice in the url names we need this vector to include a leading 0 in front of the single 'character' digits (ie "01" instead of "1"). But we don't want a leading 0 in front of the double 'character' digits (ie We DON'T want "090"). This is where str_pad comes in handy. So we are converting our numeric vector into a character vector, then saying we want all elements of this character vector to have length 2. This will basically check to see, if the elements are less than 2 characters, it will add "0"'s to the left side until it reaches length 2. If it is already length 2, it will leave it.
- Line #4 : We are creating the character string for the url for the download link. Since they all take the form of https://www.bls.gov/lau/laucntyZZ.xlsx, we can use one element of our years vector at a time.
- Line #5 : This is of similar spirit to line #4, but this is defining the path/filename of the excel file we will save.
- Line #6 : This line is just telling R to download the file at that url, save it to the defined location/name, and to read it as a non-raw text form.
- Lines #7-9 : Exit the loop if we have made it through all elements of the vector of years, otherwise increment our index by one.
